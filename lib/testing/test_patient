import pytest
from sqlalchemy.orm import Session
from models.models_init import SessionLocal, init_db
from lib.models.patient import Patient

@pytest.fixture(scope='module')
def test_client():
    # Set up the database
    init_db()
    db = SessionLocal()
    yield db
    db.close()

def test_create_patient(test_client):
    """Test creating a new patient."""
    new_patient = Patient(name="John Doe", age=30)
    test_client.add(new_patient)
    test_client.commit()

    # Query the patient back
    patient = test_client.query(Patient).filter_by(name="John Doe").first()
    
    assert patient is not None
    assert patient.age == 30
